/* ===================================================================
   styles.css — v18.2 (Consolidated • Robust • Student-friendly)
   - KaTeX “blue pill” fix (no selection, normalized spacing atoms)
   - Mobile density tweaks for phones (≤480px / ≤360px)
   - Smaller, reasonable image sizing for stems & options
   - Plain CSS (no @apply/@layer)
   =================================================================== */

/* 1) Fonts & Base Tokens */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+Bengali:wght@400;600;700&display=swap');

:root{
  /* Typography */
  --font-sans: "Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  --font-bn: "Noto Sans Bengali","Hind Siliguri","SolaimanLipi",sans-serif;

  /* Palette (light) */
  --ui-text:#111827;
  --ui-muted:#6b7280;
  --page-bg:#f6f7fb;
  --surface:#ffffff;
  --card:#ffffff;
  --cardBorder:rgba(15,23,42,.10);

  --accent:#2563eb;        /* indigo-600 */
  --accent-strong:#1d4ed8; /* indigo-700 */
  --accent-contrast:#ffffff;
  --ring:rgba(37,99,235,.25);

  --ok:#16a34a;  --okBg:rgba(22,163,74,.10);
  --err:#dc2626; --errBg:rgba(220,38,38,.10);

  /* Layout */
  --radius:12px;
  --radius-lg:14px;
  --max-width:1100px;

  /* Elevation */
  --shadow-sm:0 4px 12px rgba(2,8,23,.06);
  --shadow-md:0 6px 20px rgba(2,8,23,.10);
}

.dark,[data-theme="dark"]{
  --ui-text:#e9eef5;
  --ui-muted:#9aa4b2;
  --page-bg:#0b1220;
  --surface:#101827;
  --card:#0f172a;
  --cardBorder:rgba(255,255,255,.10);

  --accent:#6aa6ff;
  --accent-strong:#8ab7ff;
  --accent-contrast:#0b1020;
  --ring:rgba(96,165,250,.30);

  --ok:#34c759;  --okBg:rgba(52,199,89,.16);
  --err:#ff5a5f; --errBg:rgba(255,90,95,.18);

  --shadow-sm:0 4px 12px rgba(0,0,0,.18);
  --shadow-md:0 6px 20px rgba(0,0,0,.28);
}

html,body{
  margin:0; padding:0; width:100%; max-width:100%;
  overflow-x:hidden; background:var(--page-bg); color:var(--ui-text);
}
*,*::before,*::after{ box-sizing:border-box }
html{ color-scheme: light dark }

/* Bengali fallback where appropriate */
:lang(bn),[lang="bn"]{ font-family:var(--font-bn),var(--font-sans) }
:lang(bn) .mcq-question-text,
:lang(bn) .option-text,
:lang(bn) .explanation-body{ line-height:1.7 }

/* 2) Containers */
.main-container,
.chapter-questions-container{
  max-width:var(--max-width);
  margin:0 auto;
  padding:16px 20px;
}
.cq-theme-wrapper{ min-height:100vh; overflow-x:clip }
.cq-topline{ margin-bottom:.5rem }
.cq-toplink{ color:var(--accent); text-decoration:none; font-weight:600 }
.cq-toplink:hover{ text-decoration:underline }

/* Header */
.cq-header{ text-align:center; margin:0 0 12px }
.cq-title{
  margin:0; font-weight:800;
  font-size:clamp(1.6rem,1.2rem + 1.2vw,2.2rem);
  background-image:linear-gradient(90deg,#8b5cf6,var(--accent),#22d3ee);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.cq-subtitle{ margin-top:4px; color:var(--ui-muted) }

/* 3) MCQ Card */
.mcq-card{
  background:var(--card);
  border:1px solid var(--cardBorder);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow-sm);
  transition:border-color .2s, box-shadow .2s, transform .06s;
  break-inside: avoid;
}
.mcq-card + .mcq-card{ margin-top:12px }
@media (hover:hover){
  .mcq-card:hover{ border-color:rgba(15,23,42,.18); box-shadow:var(--shadow-md); transform:translateY(-2px) }
}

/* Card header */
.mcq-header{ display:flex; flex-wrap:wrap; align-items:flex-start; gap:10px; margin-bottom:10px }
.mcq-question-number{
  width:38px; height:38px; display:grid; place-items:center; flex-shrink:0;
  border-radius:10px; border:1px solid var(--cardBorder); font-weight:800; color:var(--accent-strong)
}

/* Overflow-safe question text */
.mcq-question-text{
  flex:1; min-width:0; font-size:16px; line-height:1.65;
  white-space:normal; overflow-wrap:anywhere; word-break:break-word; hyphens:auto;
  font-variant-numeric:tabular-nums;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* KaTeX: stop selection pills + normalize spacing atoms */
.mcq-question-text .katex,
.mcq-question-text .katex *{
  user-select:none;                 /* disable selection inside KaTeX */
  -webkit-user-select:none;
  -ms-user-select:none;
  background:transparent !important;
}
.mcq-question-text .katex .mspace{
  display:inline !important;        /* behave like normal space */
  width:auto !important;
  margin:0 .25em !important;        /* visual spacing */
  padding:0 !important;
  border:none !important;
}
.mcq-question-text .katex .text{
  white-space:normal !important;
  word-break:break-word !important;
}
.mcq-question-text .katex .underline .rule,
.mcq-question-text .katex .overline .rule,
.mcq-question-text .katex .frac-line{
  background:currentColor;          /* crisp lines on dark */
}
.mcq-question-text .katex-display{ max-width:100%; overflow-x:auto }
.katex-display{ padding-bottom:.25rem }

/* 4) Images — tuned sizes */
.question-image{
  aspect-ratio:auto;
  width:auto;
  max-width:340px;
  max-height:220px;
  display:block;
  margin-top:.4rem;
  margin-bottom:.25rem;
  object-fit:contain;
  background:#fff;
  border:1px solid var(--cardBorder);
  border-radius:8px;
}
.option-image{
  aspect-ratio:auto;
  width:auto;
  max-width:220px;
  max-height:160px;
  display:block;
  margin-top:.35rem;
  margin-bottom:.25rem;
  object-fit:contain;
  background:#fff;
  border:1px solid var(--cardBorder);
  border-radius:8px;
}

/* 5) Options */
.option-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px }
@media (max-width:768px){ .option-grid{ grid-template-columns:1fr } }

.option-button{
  position:relative; display:flex; align-items:flex-start; gap:10px;
  width:100%; padding:12px 14px; min-height:50px;
  background:var(--surface); border:1px solid var(--cardBorder); border-radius:10px;
  text-align:left; cursor:pointer;
  transition:border-color .2s, box-shadow .2s, transform .02s, background-color .2s;
}
.option-button:hover{ border-color:rgba(37,99,235,.45) }
.option-button:active{ transform:translateY(1px) }
.option-button:focus-visible{
  outline:3px solid var(--accent-strong); outline-offset:2px; box-shadow:0 0 0 6px var(--ring);
}

.option-label{
  width:30px; height:30px; display:grid; place-items:center; flex-shrink:0;
  border-radius:999px; border:1px solid var(--cardBorder); font-weight:800; color:var(--ui-muted); margin-top:2px;
}
.option-text{ flex:1; min-width:0; font-size:15px; line-height:1.6; overflow-wrap:anywhere; word-break:break-word }

/* Visual states + ribbons */
.option-button[data-state="correct"]{ background:var(--okBg); border-color:var(--ok) }
.option-button[data-state="wrong"]{ background:var(--errBg); border-color:var(--err) }
.option-button[data-state="disabled"]{ opacity:.85 }
.option-button[data-state="correct"]::before,
.option-button[data-state="wrong"]::before{
  content:""; position:absolute; inset:-1px auto -1px -1px; width:6px; border-radius:10px 0 0 10px;
}
.option-button[data-state="correct"]::before{ background:var(--ok) }
.option-button[data-state="wrong"]::before{ background:var(--err) }

/* 6) Feedback & Explanation */
.mcq-feedback{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; margin-top:8px; padding-top:8px; border-top:1px solid var(--cardBorder);
}
.mcq-feedback-text{ display:flex; align-items:center; gap:8px; font-weight:700 }
.mcq-feedback-text[data-correct="true"]{ color:var(--ok) }
.mcq-feedback-text[data-correct="false"]{ color:var(--err) }

.explanation-toggle{
  border:1px dashed var(--cardBorder); padding:6px 10px; border-radius:8px;
  background:transparent; cursor:pointer; color:var(--accent-strong); font-weight:700;
}
.explanation-toggle:hover{ background:rgba(37,99,235,.06) }

.mcq-explanation{
  margin-top:10px; border:1px solid var(--cardBorder); border-radius:12px; background:var(--surface);
}
.explanation-header{ padding:8px 12px; font-weight:800; border-bottom:1px solid var(--cardBorder); display:flex; align-items:center }
.explanation-body{ padding:10px 12px; line-height:1.7; color:var(--ui-muted) }

/* 7) Footer actions */
.mcq-footer{ display:flex; justify-content:flex-end; margin-top:12px }
.action-button{
  display:inline-flex; align-items:center; justify-content:center; border-radius:10px;
  padding:8px 14px; min-height:44px; font-weight:800;
  border:1px solid var(--cardBorder); text-decoration:none; color:var(--ui-text); background:var(--surface);
}
.action-button.primary{ background:var(--accent); border-color:transparent; color:#fff }
.action-button.primary:hover{ background:var(--accent-strong) }
.action-button.secondary:hover{ border-color:rgba(37,99,235,.45) }
.action-button:focus-visible{ outline:3px solid var(--accent-strong); outline-offset:2px }

/* 8) Progress bar (DisplayQuestions) */
.progress-bar-container{
  height:8px; border-radius:999px; background:rgba(15,23,42,.10);
  overflow:hidden; margin:8px 0 14px;
}
.progress-bar-fill{ height:100%; background:var(--accent); border-radius:999px; width:0% }

/* 9) ExamView (start + active + results) */
.exam-start-container{
  background:var(--card); border:1px solid var(--cardBorder); border-radius:16px; padding:18px;
  max-width:520px; width:100%; box-shadow:var(--shadow-sm); margin:0 auto;
}
.exam-time-inputs{ display:flex; align-items:center; gap:6px }
.time-input{
  width:100px; padding:8px 10px; border-radius:8px;
  border:1px solid var(--cardBorder); background:var(--surface); color:var(--ui-text);
}
.time-separator{ font-weight:700; opacity:.7 }
.start-exam-button{
  display:inline-flex; align-items:center; justify-content:center;
  padding:10px 16px; border-radius:10px; font-weight:700;
  background:var(--accent); color:#fff; border:1px solid transparent;
}
.start-exam-button:hover{ background:var(--accent-strong) }

.timer-bar{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  border:1px solid var(--cardBorder); background:var(--surface);
  border-radius:10px; padding:6px 10px; margin-bottom:10px; position:relative;
}

.exam-question .question-container{ display:flex; gap:12px; align-items:flex-start }
.mcq-number-circle{
  width:36px; height:36px; border-radius:999px; display:grid; place-items:center; font-weight:800;
  border:1px solid var(--cardBorder);
  background:linear-gradient(180deg,rgba(37,99,235,.08),rgba(37,99,235,0));
}

.exam-option-btn{
  display:flex; gap:10px; align-items:flex-start; text-align:left;
  background:var(--surface); border:1px solid var(--cardBorder);
  border-radius:10px; padding:10px 12px; width:100%;
  transition:border-color .2s, transform .02s;
}
.exam-option-btn:hover{ border-color:rgba(37,99,235,.45) }
.exam-option-btn.selected{ border-color:var(--accent); box-shadow:0 0 0 3px var(--ring) }
.option-label-circle{
  width:28px; height:28px; border-radius:999px; display:grid; place-items:center;
  font-weight:700; border:1px solid var(--cardBorder);
}

.submit-exam-button,.try-again-button{
  display:inline-flex; align-items:center; justify-content:center;
  padding:10px 16px; border-radius:10px; font-weight:700;
  background:var(--accent); color:#fff; border:1px solid transparent;
}
.submit-exam-button:hover,.try-again-button:hover{ background:var(--accent-strong) }

.results-container{
  background:var(--card); border:1px solid var(--cardBorder);
  border-radius:16px; padding:16px; box-shadow:var(--shadow-sm);
}

/* Modal */
.modal-overlay{
  position:fixed; inset:0; background:rgba(2,8,23,.5);
  display:grid; place-items:center; z-index:60;
}
.modal-content{
  background:var(--card); color:var(--ui-text);
  border:1px solid var(--cardBorder); border-radius:16px;
  padding:18px; width:min(92vw,520px);
  box-shadow:0 12px 40px rgba(2,8,23,.35);
}
.modal-title{ font-size:1.25rem; font-weight:800; margin:0 0 .25rem; text-align:center }
.modal-message{ color:var(--ui-muted); text-align:center; margin:0 0 .75rem }
.modal-actions{ display:flex; gap:10px; justify-content:center }
.modal-button{ padding:8px 14px; border-radius:10px; font-weight:700; border:1px solid var(--cardBorder) }
.modal-button.cancel{ background:var(--surface) }
.modal-button.confirm{ background:var(--accent); color:#fff; border-color:transparent }

/* 10) Utilities */
.loading-skeleton{
  height:160px; border-radius:var(--radius-lg);
  background:linear-gradient(90deg,rgba(0,0,0,.05),rgba(0,0,0,.08),rgba(0,0,0,.05));
  background-size:200% 100%; animation:shimmer 1.4s ease-in-out infinite;
}
@keyframes shimmer{ from{ background-position:200% 0 } to{ background-position:-200% 0 } }

/* Hide-only text (accessible) */
.sr-only{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* 11) Responsive (tablet-ish) */
@media (max-width:640px){
  .main-container,.chapter-questions-container{
    padding-left:max(10px,env(safe-area-inset-left));
    padding-right:max(10px,env(safe-area-inset-right));
    padding-top:6px; padding-bottom:10px;
  }
  .cq-header{ margin:0 0 8px; padding:0 10px }
  .option-button{ min-height:56px; padding:12px 16px; border-radius:12px }
}

/* ===== Mobile density tweaks ===== */
@media (max-width:480px){
  /* Page/container spacing */
  .main-container,.chapter-questions-container{
    padding-left:max(8px,env(safe-area-inset-left));
    padding-right:max(8px,env(safe-area-inset-right));
    padding-top:6px; padding-bottom:8px;
  }

  /* Cards */
  .mcq-card{ padding:12px; border-radius:10px }
  .mcq-card + .mcq-card{ margin-top:10px }

  /* Header inside card */
  .mcq-header{ gap:8px; margin-bottom:6px }
  .mcq-question-number{ width:34px; height:34px; border-radius:8px }
  .mcq-question-text{ font-size:15px; line-height:1.55 }

  /* Images (phone sizes) */
  .question-image{ max-width:260px; max-height:180px }
  .option-image  { max-width:160px; max-height:120px }

  /* Options */
  .option-grid{ gap:8px }
  .option-button{
    padding:10px 12px;
    min-height:48px;   /* still accessible */
    border-radius:10px;
    gap:8px;
  }
  .option-label{ width:28px; height:28px; margin-top:0 }
  .option-text{ font-size:14.5px; line-height:1.55 }

  /* Feedback / explanation */
  .mcq-feedback{ margin-top:6px; padding-top:6px; gap:8px }
  .explanation-toggle{ padding:5px 9px }
  .explanation-header{ padding:7px 10px }
  .explanation-body{ padding:8px 10px }

  /* Progress bar */
  .progress-bar-container{ height:6px; margin:6px 0 10px }
}

/* Ultra-small devices (older 320–360px phones) */
@media (max-width:360px){
  .mcq-card{ padding:10px }
  .mcq-card + .mcq-card{ margin-top:8px }
  .mcq-question-number{ width:32px; height:32px }
  .option-grid{ gap:6px }
  .option-button{ padding:9px 10px; min-height:46px }
  .option-text{ font-size:14px; line-height:1.5 }

  .question-image{ max-width:220px; max-height:150px }
  .option-image  { max-width:140px; max-height:110px }
}

/* 12) System Preferences */
@media (prefers-reduced-motion:reduce){
  *,*::before,*::after{ animation:none !important; transition:none !important; scroll-behavior:auto !important }
}
@media (prefers-contrast:more){
  .mcq-card,.option-button,.timer-bar{ background:var(--surface); border-color:currentColor; box-shadow:none }
  .option-button{ border-width:2px }
}
@supports not (backdrop-filter:blur(2px)){
  .mcq-card,.timer-bar{ background:var(--surface) }
}

/* 13) Print */
@media print{
  .timer-bar,.cq-topline,.mcq-footer,.modal-overlay{ display:none !important }
  .mcq-card,.results-container{ box-shadow:none; border-color:#ddd; break-inside:avoid }
  .option-button,.exam-option-btn{ background:#fff !important }
}
