/* ============================================================
   DisplayQuestions.css — Chapter parity v12.1 (with progress btns)
   ============================================================ */

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

html, body { width:100%; max-width:100%; overflow-x:hidden; margin:0; padding:0; }
*, *::before, *::after { box-sizing:border-box; }
:root{
  /* Typography */
  --font-sans:'Inter', -apple-system, BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;

  /* ---- LIGHT MODE (default) ---- */
  --text-primary:#111827;          /* slate-900 */
  --text-secondary:#6b7280;        /* slate-500 */
  --surface:#ffffff;
  --page-bg:#f6f7fb;

  /* “glass” look */
  --glass-bg: rgba(255,255,255,.85);
  --glass-border: rgba(15, 23, 42, .08);
  --glass-border-hover: rgba(15, 23, 42, .18);

  /* Cards/controls */
  --card:#ffffff;
  --cardBorder: rgba(15,23,42,.08);

  /* Accents & states */
  --accent:#2563eb;                /* indigo-600 */
  --accent-strong:#1d4ed8;         /* indigo-700 */
  --accent-contrast:#ffffff;
  --ok:#16a34a; --okBg:rgba(22,163,74,.12);
  --err:#dc2626; --errBg:rgba(220,38,38,.12);

  --radius-sm:8px; --radius-md:10px; --radius-lg:16px;
  --radius:14px;
  --max-width:1100px;

  -webkit-text-size-adjust:100%;
}

/* ---- DARK THEME ---- */
.dark, [data-theme="dark"]{
  --text-primary:#e9eef5;
  --text-secondary:#9aa4b2;

  --surface:#0b1220;
  --page-bg:#0b1220;

  --glass-bg: rgba(24, 28, 36, .60);
  --glass-border: rgba(120, 130, 150, .22);
  --glass-border-hover: rgba(160, 170, 190, .38);

  --card:#0f172a;
  --cardBorder:rgba(255,255,255,.06);

  --accent:#6aa6ff;
  --accent-strong:#8ab7ff;
  --accent-contrast:#0b1020;

  --ok:#34c759; --okBg:rgba(52,199,89,.14);
  --err:#ff5a5f; --errBg:rgba(255,90,95,.15);
}

/* ===== Root wrappers ===== */
.cq-theme-wrapper{
  font-family:var(--font-sans);
  color:var(--text-primary);
  min-height:100vh;
  background:none !important;
  overflow-x:clip;
}
.chapter-questions-container{
  width:100%;
  max-width:var(--max-width);
  margin-inline:auto;
  padding:16px 20px;
}

/* ===== Page header ===== */
.cq-header{ text-align:center; margin:0 0 12px 0; }
.cq-title{ margin:0; font-size:clamp(1.5rem,4.4vw,2.1rem); font-weight:800; }
.cq-subtitle{ margin-top:4px; color:var(--text-secondary); }

/* ===== Skeleton ===== */
.loading-skeleton {
  height:160px; border-radius:var(--radius-lg);
  background:linear-gradient(90deg, rgba(0,0,0,.05), rgba(0,0,0,.08), rgba(0,0,0,.05));
  background-size:200% 100%; animation:shimmer 1.4s ease-in-out infinite;
}
@keyframes shimmer { from{ background-position:200% 0; } to{ background-position:-200% 0; } }

/* ===== MCQ Card ===== */
.mcq-card{
  background:var(--card, var(--glass-bg));
  border:1px solid var(--cardBorder, var(--glass-border));
  border-radius:var(--radius);
  padding:14px;
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);
  transition:border-color .2s ease, transform .2s ease, background-color .2s ease;
  max-width:100%;
}
.mcq-card + .mcq-card{ margin-top:12px; }
@media (hover:hover){
  .mcq-card:hover{ border-color:var(--glass-border-hover); transform:translateY(-1px); }
}

/* Card header */
.mcq-header{
  display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between;
  gap:10px; margin-bottom:10px;
}
.mcq-question-number{
  width:38px; height:38px; display:grid; place-items:center;
  border-radius:10px; border:1px solid var(--cardBorder);
  color:var(--accent-strong); font-weight:800; flex:0 0 auto;
}
.mcq-question-text{
  flex:1 1 auto; min-width:0;
  font-size:clamp(1rem,3.4vw,1.08rem); line-height:1.6;
  overflow-wrap:anywhere; word-break:break-word;
}
.question-image{
  margin-top:8px; max-width:100%; height:auto; display:block;
  border-radius:10px; border:1px solid var(--cardBorder);
}

/* Bookmark */
.mcq-bookmark-button{
  width:40px; height:40px; display:grid; place-items:center;
  border-radius:999px; border:1px solid var(--cardBorder);
  color:var(--text-secondary); background:transparent; cursor:pointer;
  transition: border-color .2s ease, color .2s ease, background .2s ease;
  touch-action: manipulation;
}
.mcq-bookmark-button:hover{ color:var(--text-primary); border-color:var(--glass-border-hover); }
.mcq-bookmark-button[aria-pressed="true"]{
  background:rgba(106,166,255,.18); color:var(--text-primary); border-color:var(--accent-strong);
}

/* ===== Options ===== */
.option-grid{
  display:grid; grid-template-columns:repeat(2, minmax(0,1fr));
  gap:10px; max-width:100%;
}
.option-button{
  display:flex; align-items:center; gap:10px;
  width:100%; padding:12px 14px; min-height:50px;
  border:1px solid var(--cardBorder); border-radius:12px;
  background:rgba(0,0,0,.02); text-align:left; cursor:pointer; position:relative;
  transition:border-color .15s ease, background .15s ease, transform .05s ease;
  max-width:100%; touch-action:manipulation;
  overflow:visible;                 /* v12 base */
}
.dark .option-button,[data-theme="dark"] .option-button{ background:rgba(255,255,255,.02); }
@media (hover:hover){
  .option-button:hover{ background:rgba(0,0,0,.04); }
  .dark .option-button:hover,[data-theme="dark"] .option-button:hover{ background:rgba(255,255,255,.04); }
}
.option-button:active{ transform:translateY(1px); }
.option-button:focus-visible{ outline:2px solid var(--accent-strong); outline-offset:2px; }

.option-label{
  width:30px; height:30px; display:grid; place-items:center;
  border-radius:999px; border:1px solid var(--cardBorder);
  color:var(--text-secondary); font-weight:800; flex-shrink:0;
}
.option-text{
  color:var(--text-primary);
  font-size:1.02rem; line-height:1.55;
  display:block; flex:1 1 auto; min-width:0; width:100%;
  white-space:normal;
  overflow:visible;                 /* v12 base */
  overflow-wrap:anywhere;
  word-break:break-word;
  line-break:anywhere;
  -webkit-line-break:anywhere;
  hyphens:auto;
}
.option-image{
  margin-top:6px; max-width:100%; height:auto; display:block;
  border-radius:8px; border:1px solid var(--cardBorder);
}

/* States */
.option-button[data-state="selected"]{ background:rgba(138,183,255,.16); border-color:var(--accent-strong); }
.option-button[data-state="correct"]{ background:var(--okBg); border-color:var(--ok); }
.option-button[data-state="wrong"]{ background:var(--errBg); border-color:var(--err); }
.option-button[data-state="disabled"]{ opacity:.60; cursor:not-allowed; filter:saturate(.7); }

/* ===== Feedback & Explanation ===== */
.mcq-feedback{
  display:flex; justify-content:space-between; align-items:center;
  gap:8px; margin-top:10px; padding-top:10px; border-top:1px solid var(--cardBorder);
  max-width:100%;
}
.mcq-feedback-text{ display:inline-flex; align-items:center; gap:.4rem; font-weight:800; }
.mcq-feedback-text[data-correct="true"]{ color:var(--ok); }
.mcq-feedback-text[data-correct="false"]{ color:var(--err); }

.explanation-toggle{
  font-size:.95rem; font-weight:800; color:var(--accent-strong);
  background:none; border:0; cursor:pointer; padding:.25rem .1rem;
}
.mcq-explanation{
  margin-top:10px; padding:10px; background:rgba(0,0,0,.06);
  border-radius:12px; border:1px solid var(--cardBorder);
}
.dark .mcq-explanation,[data-theme="dark"] .mcq-explanation{ background:rgba(0,0,0,.16); }
.explanation-header{ font-weight:800; margin-bottom:4px; }
.explanation-body{ display:flex; gap:.45rem; color:var(--text-secondary); }

/* ===== Footer actions ===== */
.mcq-footer{ margin-top:12px; display:flex; justify-content:center; }
.action-button{
  font-family:var(--font-sans); font-weight:800; font-size:1rem;
  padding:.78rem 1.4rem; border-radius:12px;
  border:1px solid var(--cardBorder); background:rgba(0,0,0,.04);
  color:var(--text-primary); cursor:pointer;
  transition: transform .05s ease, border-color .15s ease, background .15s ease;
  min-height:46px; touch-action:manipulation;
}
.dark .action-button,[data-theme="dark"] .action-button{ background:rgba(255,255,255,.04); }
.action-button:hover{ border-color:var(--glass-border-hover); }
.action-button:active{ transform:translateY(1px); }
.action-button.primary{ background:var(--accent-strong); border-color:var(--accent-strong); color:var(--accent-contrast); }
.action-button.primary:hover{ filter:brightness(1.06); }

/* ===== Global robust wrapping ===== */
.mcq-card,
.mcq-card *:where(p, span, div){
  overflow-wrap:anywhere;
  word-break:break-word;
  line-break:anywhere;
}
.katex, .katex-html, .katex-mathml{
  white-space:normal !important;
  overflow-wrap:anywhere;
  word-break:break-word;
}
.mcq-card img, .question-image, .option-image{
  max-width:100%;
  height:auto;
  background: white; /* ensure transparent PNGs look fine */
  display:block;
}

/* =========================
   Mobile: TRUE FULL-BLEED
   ========================= */
@media (max-width:640px){
  html, body{ overflow-x:hidden; }

  .cq-theme-wrapper,
  .chapter-questions-container{
    width:100% !important; max-width:100% !important; margin:0 !important;
    padding-left:max(0px, env(safe-area-inset-left)) !important;
    padding-right:max(0px, env(safe-area-inset-right)) !important;
    padding-top:6px !important; padding-bottom:10px !important;
    background: none !important;
  }

  .cq-header{ margin:0 0 8px 0 !important; padding:0 10px !important; }

  .mcq-card{
    border-left:0 !important; border-right:0 !important; border-radius:0 !important;
    padding-left:12px !important; padding-right:12px !important;
    margin:0 0 10px 0 !important;
  }

  .option-grid{ grid-template-columns:1fr !important; gap:10px !important; margin:0 !important; }
  .option-button{ border-radius:12px !important; min-height:50px !important; padding:12px 16px !important; width:100% !important; }
}

/* =========================
   Small Tablets: keep 1 column
   ========================= */
@media (max-width:768px){
  .option-grid{ grid-template-columns:1fr !important; }
}

/* =========================
   Larger tablets polish
   ========================= */
@media (min-width:768px){
  .chapter-questions-container{ padding-left:clamp(1rem,3vw,2rem); padding-right:clamp(1rem,3vw,2rem); }
  .mcq-card{ padding:16px 18px; border-radius:16px; }
}

/* =========================
   Motion/accessibility
   ========================= */
@media (prefers-reduced-motion:reduce){
  *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
}

/* ===== v12.1: option-text overflow inside rounded pills (final lock) ===== */
.option-button { overflow: hidden !important; align-items: flex-start !important; }
.option-label { flex: 0 0 30px; margin-top: 2px; }
.option-text  {
  display:block; flex:1 1 auto; min-width:0; max-width:100%;
  white-space:normal; overflow:hidden; text-overflow:clip;
  overflow-wrap:anywhere; word-break:break-word; line-break:anywhere; -webkit-line-break:anywhere; hyphens:auto;
}

/* --- Extras kept for DisplayQuestions features --- */
.progress-bar-container {
  width: 100%; height: 8px;
  background-color: var(--cardBorder);
  border-radius: 99px;
  margin: 1.25rem 0;
  overflow: hidden;
}
.progress-bar-fill { height: 100%; background: var(--accent-strong); border-radius: 99px; }
.other-board-btn-wrapper { margin-top: 2rem; text-align: center; }
.other-board-btn {
  font-family:var(--font-sans); font-weight:800; font-size:1rem;
  padding:.78rem 1.4rem; border-radius:12px;
  border:1px solid var(--cardBorder); background:rgba(0,0,0,.04);
  color:var(--text-primary); cursor:pointer; text-decoration: none; display: inline-block;
  transition: transform .05s ease, border-color .15s ease, background .15s ease;
  min-height:46px;
}
.dark .other-board-btn,[data-theme="dark"] .other-board-btn{ background:rgba(255,255,255,.04); }
.other-board-btn:hover{ border-color:var(--glass-border-hover); }
.other-board-btn:active{ transform:translateY(1px); }